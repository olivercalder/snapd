summary: smoke test for the fs-state tool

execute: |
    # Check help
    "$TESTSTOOLS"/fs-state -h | MATCH "usage: fs-state mock-dir"
    "$TESTSTOOLS"/fs-state --help | MATCH "usage: fs-state mock-dir"
    "$TESTSTOOLS"/fs-state | MATCH "usage: fs-state mock-dir"

    # Check non existing directory
    not test -e mytestdir
    "$TESTSTOOLS"/fs-state mock-dir mytestdir
    test -d mytestdir
    test -f mytestdir.fake
    not test -d mytestdir.back

    "$TESTSTOOLS"/fs-state restore-dir mytestdir
    not test -d mytestdir
    not test -f mytestdir.fake

    # Check existing directory
    mkdir mytestdir
    touch mytestdir/mytestfile
    "$TESTSTOOLS"/fs-state mock-dir mytestdir
    test -d mytestdir
    test -f mytestdir.fake
    test -d mytestdir.back
    not test -f mytestdir/mytestfile
    "$TESTSTOOLS"/fs-state restore-dir mytestdir
    test -d mytestdir
    test -f mytestdir/mytestfile
    rm -r mytestdir

    # Restoring a dir which is not mocked is not allowed
    mkdir mytestdir
    not "$TESTSTOOLS"/fs-state restore-dir mytestdir | MATCH "The directory mytestdir is not mocked"
    rm -r mytestdir

    # Check non existing file
    "$TESTSTOOLS"/fs-state mock-file mytestfile
    test -f mytestfile
    test -f mytestfile.fake
    not test -f mytestfile.back

    "$TESTSTOOLS"/fs-state restore-file mytestfile
    not test -f mytestfile

    # Check existing file
    echo test > mytestfile
    "$TESTSTOOLS"/fs-state mock-file mytestfile
    test -f mytestfile
    test -f mytestfile.fake
    test -f mytestfile.back
    not diff mytestfile mytestfile.back
    "$TESTSTOOLS"/fs-state restore-file mytestfile
    test -f mytestfile

    # Restoring a file which is not mocked is not allowed
    touch mytestfile
    not "$TESTSTOOLS"/fs-state restore-file mytestfile
