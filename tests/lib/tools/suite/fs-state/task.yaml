summary: smoke test for the fs test tool
execute: |
    # Check help
    "$TESTSTOOLS"/fs-state -h | MATCH "usage: fs-state wait-for-file"
    "$TESTSTOOLS"/fs-state --help | MATCH "usage: fs-state wait-for-file"
    "$TESTSTOOLS"/fs-state | MATCH "usage: fs-state wait-for-file"

    # Check non existing directory
    "$TESTSTOOLS"/fs-state mock-dir "$PWD"/mytestdir
    test -d "$PWD"/mytestdir
    test -f "$PWD"/mytestdir.fake

    "$TESTSTOOLS"/fs-state restore-dir "$PWD"/mytestdir
    not test -d "$PWD"/mytestdir

    # Check existing directory
    mkdir "$PWD"/mytestdir
    "$TESTSTOOLS"/fs-state mock-dir-backup-real "$PWD"/mytestdir
    test -d "$PWD"/mytestdir
    test -f "$PWD"/mytestdir.fake
    test -d "$PWD"/mytestdir.back
    "$TESTSTOOLS"/fs-state restore-dir "$PWD"/mytestdir
    test -d "$PWD"/mytestdir
    rm -r "$PWD"/mytestdir

    # Check non existing file
    "$TESTSTOOLS"/fs-state mock-file "$PWD"/mytestfile
    test -f "$PWD"/mytestfile
    test -f "$PWD"/mytestfile.fake

    "$TESTSTOOLS"/fs-state restore-file "$PWD"/mytestfile
    not test -f "$PWD"/mytestfile

    # Check existing file
    touch "$PWD"/mytestfile
    "$TESTSTOOLS"/fs-state mock-file-backup-real "$PWD"/mytestfile
    test -f "$PWD"/mytestfile
    test -f "$PWD"/mytestfile.fake
    test -f "$PWD"/mytestfile.back
    "$TESTSTOOLS"/fs-state restore-file "$PWD"/mytestfile
    test -f "$PWD"/mytestfile

    # Check wait for file
    "$TESTSTOOLS"/fs-state wait-for-file "$PWD"/mytestfile 2 .5
    rm "$PWD"/mytestfile
    not "$TESTSTOOLS"/fs-state wait-for-file "$PWD"/mytestfile 2 .5
