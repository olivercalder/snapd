summary: Ensure that the fwupd interface grants access to the host fwupd

systems:
    # The fwupd interface is only implicit on classic distros
    - -ubuntu-core-*
    # Fwupd is not available in the Ubuntu 14.04 archive.
    - -ubuntu-14.04-*

prepare: |

execute: |
    #shellcheck source=tests/lib/snaps.sh
    . "$TESTSLIB"/snaps.sh

    echo "Install the test-snapd-fwupd" interface
    install_local test-snapd-fwupd

    echo "The fwupd plug is disconnected by default"
    snap connections test-snapd-fwupd | MATCH "fwupd +test-snapd-fwupd:fwupd +- +-"
    echo "The plug can be connected"
    snap connect test-snapd-fwupd:fwupd
    snap connections test-snapd-fwupd | MATCH "fwupd +test-snapd-fwupd:fwupd +:fwupd +manual"

    echo "With the plug connected, we can talk to fwupd"
    test-snapd-fwupd.get-version | MATCH 'variant +string "[0-9.]+"'
