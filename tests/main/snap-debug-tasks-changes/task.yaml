summary: Ensure `snap debug changes|tasks|task` commands work

prepare: |
    snap install hello-world

execute: |
    # The following debug commands access state.json directly, snapd should be stopped
    systemctl stop snapd.{socket,service}

    echo "Changes can be listed"
    snap debug changes /var/lib/snapd/state.json | MATCH "seed .*Initialize system state"

    echo "Snap changes defaults to state.json in the current directory"
    cd /var/lib/snapd
    snap debug changes | MATCH "install-snap .*Install \"hello-world\" snap"

    echo "Tasks can be listed"
    snap debug tasks --change-id=1 /var/lib/snapd/state.json | MATCH "mark-seeded .*Mark system seeded"

    echo "Individual task can be examined"
    snap debug task --task-id=1 /var/lib/snapd/state.json | MATCH "kind: mark-seeded"
    snap debug task --task-id=1 /var/lib/snapd/state.json | MATCH "summary: Mark system seeded"
