summary: Ensure that snapctl is-connected command works.

prepare: |
  snap pack test-snap
  snap install --dangerous test-snap_1_all.snap

restore: |
  snap remove test-snap

execute: |
  # network is connected by default
  test-snap.checkconn network

  snap disconnect test-snap:network

  # if not connected, we expect error status and a message
  if test-snap.checkconn network; then
    echo "expected network to be disconnected"
  fi

  # check the output is empty (except for fedora which prints cgroup warning)
  OUT=$(test-snap.checkconn network 2>&1 || true)

  if [[ "$SPREAD_SYSTEM" == fedora-* ]]; then
    echo "$OUT" | MATCH '^WARNING: cgroup v2 is not fully supported yet, proceeding with partial confinement$'
  else
    if [ -n "$OUT" ]; then
      echo "Expected no output, but got: $OUT"
      exit 1
    fi
  fi

  if test-snap.checkconn home; then
    echo "home is not expected"
  fi
