summary: Check that Jenkins user can run snaps
systems: [ubuntu-16.04-64]
environment:
    SPECIAL_USER_NAME/jenkins: jenkins
prepare: |
    # shellcheck source=tests/lib/snaps.sh
    . "$TESTSLIB/snaps.sh"
    install_local test-snapd-sh
    # Install the corresponding package that brings the special user account.
    # Specialize the code as required for a particular user.
    case "$SPECIAL_USER_NAME" in
        *) apt install "$SPECIAL_USER_NAME" ;;
    esac
restore: |
    snap remove test-snapd-sh 
    # Remove the package we installed above.
    case "$SPECIAL_USER_NAME" in
        *) apt remove --purge "$SPECIAL_USER_NAME" ;;
    esac
execute: |
    #shellcheck disable=SC2016
    su -c sh -c 'echo $HOME' "$SPECIAL_USER_NAME" | MATCH "/var/lib/$SPECIAL_USER_NAME"
    su -c 'snap run test-snapd-sh /bin/true' "$SPECIAL_USER_NAME"
