summary: Checks for snap exit codes

systems: [ubuntu-1*, ubuntu-2*]

restore: |
    umount /usr/bin/mksquashfs || true

execute: |
    echo "snap command with unknown command return exit code 5"
    set +e
    snap unknown-command
    RET=$?
    set -e
    test "$RET" -eq 5

    echo "snap command with unknown flag return exit code 5"
    set +e
    snap pack --unknown-option
    RET=$?
    set -e
    test "$RET" -eq 5

    echo "snap command with broken mksquashfs returns exit code 20"
    mount -o bind /bin/false /usr/bin/mksquashfs
    set +e
    snap pack "$TESTSLIB/snaps/test-snapd-sh"
    RET=$?
    set -e
    test "$RET" -eq 20
